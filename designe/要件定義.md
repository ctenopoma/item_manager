# 物品管理システム要件定義書

## 1. プロジェクト概要

社内の物品（PC、検証端末、書籍等）の在庫数、貸出状態、返却期限を一元管理するアプリケーション。PythonをベースにWebアプリケーションとして構築し、管理者がマスターデータを管理、一般ユーザーがブラウザから貸出・返却操作を行う。物品のリアルタイムな利用状況は、社内wikiツール「Growi」上でも閲覧可能にする。

## 2. システム構成

- アプリケーション形態: Webアプリケーション（サーバーサイドレンダリング + API）
- サーバー: Python (FastAPI)クライアント: PCブラウザ連携システム: Growi（オンプレミス版）

```mermaid :コード スニペット
graph TD
    User[一般ユーザー]
    Admin[管理者]
    Growi[Growi (表示用)]

    subgraph "物品管理システム (Python/FastAPI)"
        WebUI[Web画面 (HTML/Jinja2)]
        API[APIエンドポイント]
        DB[(データベース)]
    end

    User -- ブラウザで操作 (貸出/返却) --> WebUI
    Admin -- ブラウザで操作 (マスタ管理) --> WebUI
    WebUI -- 内部処理 --> DB
    Growi -- JSONデータ取得 (GET) --> API
    API -- データ参照 --> DB
```

## 3. アクター定義

|アクター|役割|
|--|--|
|管理者 (Admin)|ユーザー情報の登録・管理、物品情報の登録・管理を行う特権ユーザー。|
|一般ユーザー (User)|自身のIDでログインし、物品の貸出・返却操作を行う社員。|
|Growi (System)|API経由で物品のステータス情報を取得し、表示するシステム。|

## 4. 機能要件

### 4.1. 共通・認証機能

- ログイン認証: IDとパスワードによる認証を行う。
- セッション管理: ログイン状態を保持する。
- 権限管理: ログインユーザーのRole（Admin/User）により、アクセス可能なメニューを制御する。

### 4.2. 管理者機能 (Admin)

- ユーザー管理
    - ユーザー一覧表示
    - 新規ユーザー登録（社員番号/ID, 氏名, 初期パスワード, 権限）
    - ユーザー編集・削除（退職処理など）
- 物品管理
    - 物品一覧表示
    - 新規物品登録（物品名, 管理番号, カテゴリ, デフォルト貸出期間）
    - 物品編集・削除（廃棄処理）
- 強制操作
    - 貸出中の物品を強制的に「返却済」にする機能（退職時の未返却対応等）。

### 4.3. 一般ユーザー機能 (User)

- 物品一覧・検索
    - 全物品のリストを表示。
    - ステータス（在庫あり/貸出中）の確認。
    - キーワード検索機能。
- 貸出操作
    - 「在庫あり」の物品に対し、貸出処理を行う。
    - 返却予定日を入力（またはデフォルト値を使用）して確定する。返却操作自身が借りている物品に対し、返却処理を行う。

### 4.4. 外部連携機能 (Growi API)

- 物品ステータス取得API
    - Method: GET
    - Endpoint: /api/v1/items/status 
    - Response: JSON形式（全物品のリスト）
        - 物品名
        - 管理番号
        - ステータス（Available / Borrowed）
        - 現在の利用者名（Borrowedの場合）
        - 返却予定日
        - 延滞フラグ（予定日を超過している場合 true）
    - Security: Growiサーバーからのアクセスを許可（CORS等）。

## 5. データ要件 (データベース設計案)

### 5.1. Users

テーブルユーザー情報を管理する。

| カラム名 | データ型 | 説明 |
| :--- | :--- | :--- |
| id | Integer (PK) | 自動採番 |
| username | String | ログインID（社員番号等）、ユニーク制約 |
| hashed_password | String | ハッシュ化されたパスワード |
| display_name | String | 表示名（例: 山田 太郎） |
| role | Enum/String | 権限 (admin, user) |
| is_active | Boolean | 有効フラグ (True:有効, False:無効) |

### 5.2. Items

 テーブル物品のマスター情報および現在の状態を保持する。
 
 | カラム名 | データ型 | 説明 |
 | :--- | :--- | :--- |
 | id | Integer (PK) | 自動採番 |
 | name | String | 物品名 |
 | management_code | String | 管理用コード（テプラ等）、ユニーク制約 |
 | category | String | カテゴリ（PC, 書籍, etc） |
 | status | Enum/String | 状態 (available, borrowed, broken) |
 | owner_id | Integer (FK) | 現在借りているUserのID (NULL許容) |
 | due_date | Date | 返却予定日 (NULL許容) |
 
 ### 5.3. Logsテーブル
 
 貸出・返却の履歴を記録する（監査ログ）。
 
 | カラム名 | データ型 | 説明 |
 | :--- | :--- | :--- |
 | id | Integer (PK) | 自動採番 |
 | item_id | Integer (FK) | 対象物品ID |
 | user_id | Integer (FK) | 操作ユーザーID |
 | action | String | 操作内容 (borrow, return) |
 | created_at | DateTime | 操作日時 |
  
## 6. 非機能要件・技術スタック
  
- 開発言語: Python 3.10以上
- Webフレームワーク: FastAPI
    - テンプレートエンジン: Jinja2 (HTML生成用)
- データベース: SQLite
- ORM: SQLAlchemy または SQLModel
- フロントエンド: HTML5, Bootstrap 5 (レスポンシブ対応)
- 実行環境: オンプレミスサーバー (Dockerコンテナ推奨)

## 7. Growi連携仕様（クライアントサイド）

Growiのページ（HTML埋め込み可能な箇所）に以下のスクリプトを配置し、表を描画する想定。
1. PythonアプリのAPIをFetch。
2. 取得したJSONデータをループ処理し、HTMLのTableタグを生成。
3. 延滞フラグ == true の行は赤色でハイライト表示する。
